<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Digital AP Notes</title>
<style>
  body {
    font-family: 'Times New Roman', Times, serif;
    background-color: #f7f7fb;
    color: #1f2937;
    margin: 0;
    line-height: 1.5;
  }
  .wrap {
    max-width: 880px;
    margin: 32px auto;
    padding: 20px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h1 { text-align: center; font-size: 24px; margin-bottom: 20px; }
  label { font-weight: bold; display: block; margin-top: 12px; margin-bottom: 4px; }
  input[type="text"], input[type="date"], select, textarea {
    width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
    font-family: 'Times New Roman', Times, serif; font-size: 16px;
  }
  textarea { resize: vertical; }
  .grid { display: grid; gap: 12px; }
  @media (min-width: 700px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
  .group { border: 1px dashed #ccc; padding: 10px; border-radius: 8px; margin-top: 8px; }
  .checks { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
  .check { display: flex; align-items: center; gap: 8px; }
  .other-input { display: none; margin-top: 6px; }
  button {
    background: #2563eb; color: white; border: none; border-radius: 8px;
    padding: 10px 16px; font-family: 'Times New Roman', Times, serif;
    font-size: 16px; cursor: pointer;
  }
  button.secondary { background: white; color: #2563eb; border: 1px solid #2563eb; }
  .toolbar { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }
  .toast {
    position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
    background: rgba(0,0,0,0.85); color: #fff; padding: 10px 14px;
    border-radius: 8px; font-size: 14px; opacity: 0; pointer-events: none;
    transition: opacity .25s ease; z-index: 1000;
  }
  .toast.show { opacity: 1; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Digital AP Notes</h1>

    <label>Success Coach Name</label>
    <input id="coach_name" type="text" placeholder="Enter coach name" />

    <label>Student Name</label>
    <input id="student_name" type="text" placeholder="Enter student name" />

    <div class="grid grid-2">
      <div>
        <label>Week in Term</label>
        <select id="week">
          <option value="" disabled selected>Select week</option>
          <option>Week 3</option>
          <option>Week 7</option>
          <option>Week 12</option>
        </select>
      </div>
      <div>
        <label>Date of Note</label>
        <input id="date_of_note" type="date" />
      </div>
    </div>

    <label>Academic Status</label>
    <select id="academic_status">
      <option value="" disabled selected>Select status</option>
      <option>Performing Well</option>
      <option>Needs Attention</option>
      <option>At Risk</option>
    </select>

    <label>Responsiveness (1–4)</label>
    <select id="responsiveness">
      <option value="" disabled selected>Select responsiveness</option>
      <option>4 - Highly Responsive</option>
      <option>3 - Responsive</option>
      <option>2 - Inconsistent</option>
      <option>1 - Unresponsive</option>
    </select>

    <label>Current Support Need</label>
    <select id="support_need">
      <option value="" disabled selected>Select need</option>
      <option>High</option>
      <option>Medium</option>
      <option>Low</option>
    </select>

    <label>Current Risk Factors (select all that apply)</label>
    <div class="group">
      <div class="checks">
        <label class="check"><input type="checkbox" value="Time management">Time management</label>
        <label class="check"><input type="checkbox" value="Mental or physical health">Mental or physical health</label>
        <label class="check"><input type="checkbox" value="Work or caregiving demands">Work or caregiving demands</label>
        <label class="check"><input type="checkbox" value="Academic difficulty">Academic difficulty</label>
        <label class="check"><input type="checkbox" value="Low motivation">Low motivation</label>
        <label class="check"><input type="checkbox" value="Technology or internet issues">Technology or internet issues</label>
        <label class="check"><input type="checkbox" value="Unresponsive">Unresponsive</label>
        <label class="check"><input type="checkbox" value="Personal/life challenges">Personal/life challenges</label>
        <label class="check"><input id="risk_other_chk" type="checkbox" value="Other">Other (specify below)</label>
      </div>
      <input type="text" id="risk_other_text" class="other-input" placeholder="Please specify other risk factor" />
    </div>

    <label>Active Goals (1–2 specific goals discussed)</label>
    <textarea id="active_goals" rows="3" placeholder="E.g., Build a consistent study routine, pass all classes, and apply for a job or internship."></textarea>

    <label>Progress Summary (3–5 sentences)</label>
    <textarea id="progress_summary" rows="5" placeholder="Summarize engagement, challenges, and wins."></textarea>

    <label>Successes and Breakthroughs</label>
    <textarea id="successes_breakthroughs" rows="4" placeholder="Describe recent achievements, improvements, or positive changes."></textarea>

    <label>Concerns to Monitor</label>
    <textarea id="concerns_monitor" rows="4" placeholder="List any ongoing challenges, risks, or behaviors to keep an eye on."></textarea>

    <div class="toolbar">
      <button id="btnMarkdown">Export Text</button>
      <button id="btnCopyMarkdown">Copy Text</button>
      <button class="secondary" id="btnClear">Reset</button>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const toast = document.getElementById('toast');
  const coachField = document.getElementById('coach_name');
  const riskOtherChk = document.getElementById('risk_other_chk');
  const riskOtherText = document.getElementById('risk_other_text');

  // Show/hide "Other" textbox
  function toggleOther() {
    riskOtherText.style.display = riskOtherChk.checked ? 'block' : 'none';
    if (!riskOtherChk.checked) riskOtherText.value = '';
  }
  riskOtherChk.addEventListener('change', toggleOther);
  toggleOther(); // initialize on load

  // Toast helper
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1800);
  }

  // --- Remember & auto-fill Success Coach Name (localStorage) ---
  // Load stored name on page load
  const storedCoach = localStorage.getItem('coach_name');
  if (storedCoach) {
    coachField.value = storedCoach;
  }
  // Track times the field has been filled (on blur) then store after 2 entries
  let nameCount = Number(localStorage.getItem('coach_name_count')) || 0;
  coachField.addEventListener('blur', () => {
    const nameValue = coachField.value.trim();
    if (nameValue.length > 1) {
      nameCount += 1;
      localStorage.setItem('coach_name_count', String(nameCount));
      if (nameCount >= 2) {
        localStorage.setItem('coach_name', nameValue);
        // Optional: confirm once when it first gets saved
        if (nameCount === 2 && (!storedCoach || storedCoach !== nameValue)) {
          showToast('Saved coach name for next time');
        }
      }
    }
  });

  // Collect all data
  function collectData() {
    const risks = Array.from(document.querySelectorAll('.group input[type="checkbox"]:checked')).map(x => x.value);
    if (riskOtherChk.checked && riskOtherText.value.trim()) {
      risks.push("Other: " + riskOtherText.value.trim());
    }
    return {
      coach: coachField.value,
      student: document.getElementById('student_name').value,
      week: document.getElementById('week').value,
      date: document.getElementById('date_of_note').value,
      status: document.getElementById('academic_status').value,
      responsiveness: document.getElementById('responsiveness').value,
      support: document.getElementById('support_need').value,
      risks: risks,
      goals: document.getElementById('active_goals').value,
      summary: document.getElementById('progress_summary').value,
      successes: document.getElementById('successes_breakthroughs').value,
      concerns: document.getElementById('concerns_monitor').value
    };
  }

  function buildPlainText(d) {
    const r = d.risks && d.risks.length ? d.risks.join('\n') : 'None';
    return `Digital AP Notes
Success Coach: ${d.coach || '—'}
Student: ${d.student || '—'}
Week: ${d.week || '—'}
Date: ${d.date || '—'}

Academic Overview
Status: ${d.status || '—'}
Responsiveness: ${d.responsiveness || '—'}
Support Need: ${d.support || '—'}

Current Risk Factors
${r}

Active Goals
${d.goals || '—'}

Progress Summary
${d.summary || '—'}

Successes and Breakthroughs
${d.successes || '—'}

Concerns to Monitor
${d.concerns || '—'}

Exported ${new Date().toLocaleString()}`;
  }

  function downloadText(filename, text) {
    const blob = new Blob([text], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 0);
  }

  async function copyText(text) {
    try {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
      } else {
        // Fallback for non-HTTPS contexts
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.focus(); ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }
      showToast('Copied to clipboard');
    } catch (e) {
      showToast('Copy failed – check permissions');
    }
  }

  // Buttons
  const btnDownload = document.getElementById('btnMarkdown');
  const btnCopy = document.getElementById('btnCopyMarkdown');
  const btnClear = document.getElementById('btnClear');

  btnDownload.onclick = () => {
    const d = collectData();
    const safe = (d.student || 'entry').trim().replace(/\s+/g, '_').replace(/[^A-Za-z0-9_\-]/g, '');
    downloadText(`digital_ap_notes_${safe}.txt`, buildPlainText(d));
    showToast('Downloaded file');
  };

  btnCopy.onclick = () => copyText(buildPlainText(collectData()));

  btnClear.onclick = () => {
    document.querySelectorAll('input,select,textarea').forEach(e => {
      if (e.type === 'checkbox') e.checked = false;
      else e.value = '';
    });
    toggleOther();
    showToast('Cleared');
  };
});
</script>
</body>
</html>
