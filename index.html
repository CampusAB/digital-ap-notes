<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Digital AP Notes</title>
<style>
  body {
    font-family: 'Times New Roman', Times, serif;
    background-color: #f7f7fb;
    color: #1f2937;
    margin: 0;
    line-height: 1.5;
  }
  .wrap {
    max-width: 880px;
    margin: 32px auto;
    padding: 20px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h1 { text-align: center; font-size: 24px; margin-bottom: 20px; }
  label { font-weight: bold; display: block; margin-top: 12px; margin-bottom: 4px; }
  input[type="text"], input[type="date"], select, textarea {
    width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
    font-family: 'Times New Roman', Times, serif; font-size: 16px;
  }
  textarea { resize: vertical; }
  .grid { display: grid; gap: 12px; }
  @media (min-width: 700px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
  .group { border: 1px dashed #ccc; padding: 10px; border-radius: 8px; margin-top: 8px; }
  .checks { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
  .check { display: flex; align-items: center; gap: 8px; }
  .other-input { display: none; margin-top: 6px; }
  .toolbar { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }
  button {
    background: #2563eb; color: white; border: none; border-radius: 8px;
    padding: 10px 16px; font-family: 'Times New Roman', Times, serif;
    font-size: 16px; cursor: pointer;
  }
  button.secondary { background: white; color: #2563eb; border: 1px solid #2563eb; }
  .toast {
    position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
    background: rgba(0,0,0,0.85); color: #fff; padding: 10px 14px;
    border-radius: 8px; font-size: 14px; opacity: 0; pointer-events: none;
    transition: opacity .25s ease; z-index: 1000;
  }
  .toast.show { opacity: 1; }

  /* View control */
  .hidden { display: none !important; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Digital AP Notes</h1>

    <!-- Always visible header inputs -->
    <label>Success Coach Name</label>
    <input id="coach_name" type="text" placeholder="Enter coach name" />

    <label>Student Name</label>
    <input id="student_name" type="text" placeholder="Enter student name" />

    <div class="grid grid-2">
      <div>
        <label>Week in Term</label>
        <select id="week">
          <option value="" disabled selected>Select week</option>
          <option>Week 3</option>
          <option>Week 7</option>
          <option>Week 12</option>
        </select>
      </div>
      <div>
        <label>Date of Note</label>
        <input id="date_of_note" type="date" />
      </div>
    </div>

    <!-- NEW: Primary / Secondary Risk Reasons (under Week in Term) -->
    <div id="risk_reasons_row" class="grid grid-2 phase-regular">
      <div>
        <label>Primary Risk Reason (select one)</label>
        <select id="risk_primary">
          <option value="" disabled selected>Select a primary risk</option>
          <option>Unexpected emergency</option>
          <option>Family Situation - Caretaker</option>
          <option>Family Situation - Death in Family</option>
          <option>Family Situation - Insufficient study environment</option>
          <option>Physical Health - Short term recoverable injury/illness</option>
          <option>Physical Health - Unexpected hospitalization</option>
          <option>Physical Health - Pre-planned Medical Procedure</option>
          <option>Physical Health - Newly diagnosed condition</option>
          <option>Mental Health - Anxiety</option>
          <option>Mental Health - Depression</option>
          <option>Mental Health - Burnout/Workload challenges</option>
          <option>Mental Health - Other</option>
          <option>Food Insecurity</option>
          <option>Housing Insecurity</option>
          <option>Financial Struggles - Can't afford payment</option>
          <option>Financial Struggles - Insufficient Employment/Needs Employment</option>
          <option>Financial Struggles - Needs New Job</option>
          <option>Work Conflict - Work schedule conflicts with class time</option>
          <option>Work Conflict - Accepted a new job with conflicting hours or additional responsibilities</option>
          <option>Life Situation - Relocation to a new state or home (e.g. due to military, family, or job relocation)</option>
          <option>Life Situation - Incarcerated</option>
          <option>Life Situation - Career goal change (wants to pursue another degree)</option>
          <option>Missing documents - Missing Proof of Graduation</option>
          <option>Financial Aid - Missing FAFSA</option>
          <option>Financial Aid - SAP Violation</option>
          <option>Financial Aid - Financial Aid delayed</option>
          <option>Unsatisfied with program - Faculty</option>
          <option>Unsatisfied with program - Success Coach</option>
          <option>Unsatisfied with program - Onboarding Specialist</option>
          <option>Unsatisfied with program - Curriculum content</option>
          <option>Unsatisfied with program - Overall program</option>
          <option>Time Constraints - Timezone</option>
          <option>Time Constraints - Didn't understand time committment</option>
          <option>Tech Issue - CW User Challenges</option>
          <option>Tech Issue - Laptop/Hotspot did not arrive in time for class start</option>
          <option>Tech Issue - Laptop malfunction</option>
          <option>Tech Issue - Hotspot malfunction</option>
          <option>Tech Issue - Lack of internet coverage</option>
          <option>Data Inaccuracy - Incorrectly marked absent</option>
          <option>Data Inaccuracy - Incorrectly on a class list</option>
          <option>Unresponsive - Ignoring communication</option>
          <option>Unresponsive - Non-functional phone number</option>
          <option>Academic - Skills Issues</option>
          <option>Academic - Schedule Change</option>
          <option>Legal Obligations (Court appearance, etc)</option>
          <option>Military Obligations</option>
          <option>Attending another school - Online</option>
          <option>Attending another school - In Person</option>
          <option>Misconduct - Other</option>
          <option>Misconduct - Inappropriate behavior</option>
          <option>Misconduct - Academic dishonesty</option>
          <option>Natural Disaster</option>
          <option>ON TRACK</option>
        </select>
      </div>
      <div>
        <label>Secondary Risk Reason (select one)</label>
        <select id="risk_secondary">
          <option value="" disabled selected>Select a secondary risk</option>
          <!-- Same list for convenience -->
          <option>Unexpected emergency</option>
          <option>Family Situation - Caretaker</option>
          <option>Family Situation - Death in Family</option>
          <option>Family Situation - Insufficient study environment</option>
          <option>Physical Health - Short term recoverable injury/illness</option>
          <option>Physical Health - Unexpected hospitalization</option>
          <option>Physical Health - Pre-planned Medical Procedure</option>
          <option>Physical Health - Newly diagnosed condition</option>
          <option>Mental Health - Anxiety</option>
          <option>Mental Health - Depression</option>
          <option>Mental Health - Burnout/Workload challenges</option>
          <option>Mental Health - Other</option>
          <option>Food Insecurity</option>
          <option>Housing Insecurity</option>
          <option>Financial Struggles - Can't afford payment</option>
          <option>Financial Struggles - Insufficient Employment/Needs Employment</option>
          <option>Financial Struggles - Needs New Job</option>
          <option>Work Conflict - Work schedule conflicts with class time</option>
          <option>Work Conflict - Accepted a new job with conflicting hours or additional responsibilities</option>
          <option>Life Situation - Relocation to a new state or home (e.g. due to military, family, or job relocation)</option>
          <option>Life Situation - Incarcerated</option>
          <option>Life Situation - Career goal change (wants to pursue another degree)</option>
          <option>Missing documents - Missing Proof of Graduation</option>
          <option>Financial Aid - Missing FAFSA</option>
          <option>Financial Aid - SAP Violation</option>
          <option>Financial Aid - Financial Aid delayed</option>
          <option>Unsatisfied with program - Faculty</option>
          <option>Unsatisfied with program - Success Coach</option>
          <option>Unsatisfied with program - Onboarding Specialist</option>
          <option>Unsatisfied with program - Curriculum content</option>
          <option>Unsatisfied with program - Overall program</option>
          <option>Time Constraints - Timezone</option>
          <option>Time Constraints - Didn't understand time committment</option>
          <option>Tech Issue - CW User Challenges</option>
          <option>Tech Issue - Laptop/Hotspot did not arrive in time for class start</option>
          <option>Tech Issue - Laptop malfunction</option>
          <option>Tech Issue - Hotspot malfunction</option>
          <option>Tech Issue - Lack of internet coverage</option>
          <option>Data Inaccuracy - Incorrectly marked absent</option>
          <option>Data Inaccuracy - Incorrectly on a class list</option>
          <option>Unresponsive - Ignoring communication</option>
          <option>Unresponsive - Non-functional phone number</option>
          <option>Academic - Skills Issues</option>
          <option>Academic - Schedule Change</option>
          <option>Legal Obligations (Court appearance, etc)</option>
          <option>Military Obligations</option>
          <option>Attending another school - Online</option>
          <option>Attending another school - In Person</option>
          <option>Misconduct - Other</option>
          <option>Misconduct - Inappropriate behavior</option>
          <option>Misconduct - Academic dishonesty</option>
          <option>Natural Disaster</option>
          <option>ON TRACK</option>
        </select>
      </div>
    </div>

    <!-- Regular (Weeks 3/7) content -->
    <div id="regular_section" class="phase-regular">
      <label>Academic Status</label>
      <select id="academic_status">
        <option value="" disabled selected>Select status</option>
        <option>Performing Well</option>
        <option>Needs Attention</option>
        <option>At Risk</option>
      </select>

      <label>Responsiveness (1–4)</label>
      <select id="responsiveness">
        <option value="" disabled selected>Select responsiveness</option>
        <option>4 - Highly Responsive</option>
        <option>3 - Responsive</option>
        <option>2 - Inconsistent</option>
        <option>1 - Unresponsive</option>
      </select>

      <label>Current Support Need</label>
      <select id="support_need">
        <option value="" disabled selected>Select need</option>
        <option>High</option>
        <option>Medium</option>
        <option>Low</option>
      </select>

      <label>Current Risk Factors (select all that apply)</label>
      <div class="group">
        <div class="checks">
          <label class="check"><input type="checkbox" value="Time management">Time management</label>
          <label class="check"><input type="checkbox" value="Mental or physical health">Mental or physical health</label>
          <label class="check"><input type="checkbox" value="Work or caregiving demands">Work or caregiving demands</label>
          <label class="check"><input type="checkbox" value="Academic difficulty">Academic difficulty</label>
          <label class="check"><input type="checkbox" value="Low motivation">Low motivation</label>
          <label class="check"><input type="checkbox" value="Technology or internet issues">Technology or internet issues</label>
          <label class="check"><input type="checkbox" value="Unresponsive">Unresponsive</label>
          <label class="check"><input type="checkbox" value="Personal/life challenges">Personal/life challenges</label>
          <label class="check"><input id="risk_other_chk" type="checkbox" value="Other">Other (specify below)</label>
        </div>
        <input type="text" id="risk_other_text" class="other-input" placeholder="Please specify other risk factor" />
      </div>

      <label>Active Goals (1–2 specific goals discussed)</label>
      <textarea id="active_goals" rows="3" placeholder="E.g., Build a consistent study routine, pass all classes, and apply for a job or internship."></textarea>

      <label>Progress Summary (3–5 sentences)</label>
      <textarea id="progress_summary" rows="5" placeholder="Summarize engagement, challenges, and wins."></textarea>

      <label>Successes and Breakthroughs</label>
      <textarea id="successes_breakthroughs" rows="4" placeholder="Describe recent achievements, improvements, or positive changes."></textarea>

      <label>Concerns to Monitor</label>
      <textarea id="concerns_monitor" rows="4" placeholder="List any ongoing challenges, risks, or behaviors to keep an eye on."></textarea>
    </div>

    <!-- WEEK 12 VIEW -->
    <div id="week12_section" class="hidden">
      <label>Term Outcome (select one)</label>
      <select id="term_outcome">
        <option value="" disabled selected>Select outcome</option>
        <option>❌Failed all classes</option>
        <option>✅Passed all classes</option>
        <option>Mixed performance</option>
      </select>

      <label>Performance Summary (2–3 sentences)</label>
      <textarea id="performance_summary" rows="4" placeholder="What most impacted their success or struggle this term?"></textarea>

      <label>Next Term Goals (1–3)</label>
      <textarea id="next_term_goals" rows="4" placeholder="List 1–3 academic, personal, or career goals."></textarea>
    </div>

    <div class="toolbar">
      <button id="btnExport">Export Text</button>
      <button id="btnCopy">Copy Text</button>
      <button class="secondary" id="btnClear">Reset</button>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const toast = document.getElementById('toast');

  // Elements
  const coachField = document.getElementById('coach_name');
  const weekSel = document.getElementById('week');
  const riskOtherChk = document.getElementById('risk_other_chk');
  const riskOtherText = document.getElementById('risk_other_text');
  const regularSection = document.getElementById('regular_section');
  const riskReasonsRow = document.getElementById('risk_reasons_row');
  const week12Section = document.getElementById('week12_section');

  // Toast helper
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1800);
  }

  // Show/hide "Other" textbox
  function toggleOther() {
    if (!riskOtherChk) return;
    riskOtherText.style.display = riskOtherChk.checked ? 'block' : 'none';
    if (!riskOtherChk.checked) riskOtherText.value = '';
  }
  if (riskOtherChk) {
    riskOtherChk.addEventListener('change', toggleOther);
    toggleOther();
  }

  // Remember & auto-fill Success Coach Name (localStorage) — store after 2 entries
  const storedCoach = localStorage.getItem('coach_name');
  if (storedCoach) coachField.value = storedCoach;
  let nameCount = Number(localStorage.getItem('coach_name_count')) || 0;
  coachField.addEventListener('blur', () => {
    const nameValue = coachField.value.trim();
    if (nameValue.length > 1) {
      nameCount += 1;
      localStorage.setItem('coach_name_count', String(nameCount));
      if (nameCount >= 2) {
        localStorage.setItem('coach_name', nameValue);
        if (nameCount === 2 && (!storedCoach || storedCoach !== nameValue)) {
          showToast('Saved coach name for next time');
        }
      }
    }
  });

  // Mode switch based on Week selection
  function updateMode() {
    const isWeek12 = weekSel.value === 'Week 12';
    // For Week 12: show only risk reason row? (spec says keep names+date; replace original options with outcome screen)
    // We'll keep the Primary/Secondary Risk Reason row visible in regular mode only.
    riskReasonsRow.classList.toggle('hidden', isWeek12);
    regularSection.classList.toggle('hidden', isWeek12);
    week12Section.classList.toggle('hidden', !isWeek12);
  }
  weekSel.addEventListener('change', updateMode);
  updateMode();

  // Collect data
  function collectData() {
    const isWeek12 = weekSel.value === 'Week 12';

    // Risks (checkboxes; only relevant in regular mode)
    let risks = [];
    if (!isWeek12) {
      risks = Array.from(document.querySelectorAll('.group input[type="checkbox"]:checked')).map(x => x.value);
      const roc = document.getElementById('risk_other_chk');
      const rot = document.getElementById('risk_other_text');
      if (roc && roc.checked && rot && rot.value.trim()) {
        risks.push('Other: ' + rot.value.trim());
      }
    }

    const data = {
      coach: document.getElementById('coach_name').value,
      student: document.getElementById('student_name').value,
      week: document.getElementById('week').value,
      date: document.getElementById('date_of_note').value,

      // New: primary/secondary risk reasons (when visible)
      risk_primary: document.getElementById('risk_primary')?.value || null,
      risk_secondary: document.getElementById('risk_secondary')?.value || null,

      // Regular mode fields
      status: document.getElementById('academic_status')?.value || null,
      responsiveness: document.getElementById('responsiveness')?.value || null,
      support: document.getElementById('support_need')?.value || null,
      risks,

      goals: document.getElementById('active_goals')?.value || null,
      summary: document.getElementById('progress_summary')?.value || null,
      successes: document.getElementById('successes_breakthroughs')?.value || null,
      concerns: document.getElementById('concerns_monitor')?.value || null,

      // Week 12 fields
      term_outcome: document.getElementById('term_outcome')?.value || null,
      performance_summary: document.getElementById('performance_summary')?.value || null,
      next_term_goals: document.getElementById('next_term_goals')?.value || null,

      is_week12: isWeek12
    };

    return data;
  }

  // Build plain text report (no symbols)
  function buildPlainText(d) {
    if (d.is_week12) {
      // Week 12 layout
      return `Digital AP Notes
Success Coach: ${d.coach || '—'}
Student: ${d.student || '—'}
Week: ${d.week || '—'}
Date: ${d.date || '—'}

Term Outcome
${d.term_outcome || '—'}

Performance Summary
${d.performance_summary || '—'}

Next Term Goals
${d.next_term_goals || '—'}

Exported ${new Date().toLocaleString()}`;
    } else {
      // Regular layout
      const r = d.risks && d.risks.length ? d.risks.join('\n') : 'None';
      return `Digital AP Notes
Success Coach: ${d.coach || '—'}
Student: ${d.student || '—'}
Week: ${d.week || '—'}
Date: ${d.date || '—'}

Primary Risk Reason
${d.risk_primary || '—'}

Secondary Risk Reason
${d.risk_secondary || '—'}

Academic Overview
Status: ${d.status || '—'}
Responsiveness: ${d.responsiveness || '—'}
Support Need: ${d.support || '—'}

Current Risk Factors
${r}

Active Goals
${d.goals || '—'}

Progress Summary
${d.summary || '—'}

Successes and Breakthroughs
${d.successes || '—'}

Concerns to Monitor
${d.concerns || '—'}

Exported ${new Date().toLocaleString()}`;
    }
  }

  function downloadText(filename, text) {
    const blob = new Blob([text], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 0);
  }

  async function copyText(text) {
    try {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
      } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed'; ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.focus(); ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }
      showToast('Copied to clipboard');
    } catch (e) {
      showToast('Copy failed – check permissions');
    }
  }

  // Buttons
  const btnExport = document.getElementById('btnExport');
  const btnCopy = document.getElementById('btnCopy');
  const btnClear = document.getElementById('btnClear');

  btnExport.onclick = () => {
    const d = collectData();
    const safe = (d.student || 'entry').trim().replace(/\s+/g, '_').replace(/[^A-Za-z0-9_\-]/g, '');
    downloadText(`digital_ap_notes_${safe}.txt`, buildPlainText(d));
    showToast('Downloaded file');
  };
  btnCopy.onclick = () => copyText(buildPlainText(collectData()));
  btnClear.onclick = () => {
    document.querySelectorAll('input,select,textarea').forEach(e => {
      if (e.type === 'checkbox') e.checked = false; else e.value = '';
    });
    if (riskOtherText) riskOtherText.style.display = 'none';
    updateMode();
    showToast('Cleared');
  };
});
</script>
</body>
</html>
